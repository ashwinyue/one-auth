# One-Auth API 测试文件说明

## 概述

本目录包含了 One-Auth 项目的完整 API 接口测试文件，采用类似 GoLand 的 `.http` 文件格式，可以在支持 HTTP Client 的 IDE 中直接运行，也可以通过命令行工具执行。

## 文件结构

```
api-tests/
├── 01-auth.http          # 认证相关接口测试
├── 02-user.http          # 用户管理接口测试
├── 03-role.http          # 角色管理接口测试
├── 04-permission.http    # 权限管理接口测试
├── 05-tenant.http        # 租户管理接口测试
├── 06-menu.http          # 菜单管理接口测试
├── 07-post.http          # 博客文章管理接口测试
└── README.md             # 本说明文档
```

## 使用方法

### 1. IDE 环境使用

#### JetBrains IDEs (IntelliJ IDEA, GoLand, WebStorm 等)
1. 直接在 IDE 中打开 `.http` 文件
2. 点击接口旁边的绿色箭头执行单个接口
3. 使用 `Ctrl+Enter` (Windows/Linux) 或 `Cmd+Enter` (macOS) 快速执行
4. 在 `Services` 面板中查看执行结果

#### VS Code
1. 安装 `REST Client` 扩展
2. 打开 `.http` 文件
3. 点击 `Send Request` 链接执行接口

### 2. 命令行使用

可以使用 `curl` 或其他 HTTP 客户端工具，根据文件中的示例构造请求。

## 环境配置

### 基础配置
所有测试文件都使用以下基础配置：
- 基础URL: `http://localhost:5555`
- 内容类型: `application/json`

### 环境变量
测试文件会自动设置和使用以下环境变量：
- `access_token`: 用户登录后的访问令牌
- `refresh_token`: 刷新令牌
- `user_id`: 当前用户ID
- `created_user_id`: 创建的测试用户ID
- `created_role_id`: 创建的测试角色ID
- `created_post_id`: 创建的测试博客文章ID
- 其他动态生成的ID变量

## 测试执行顺序

建议按以下顺序执行测试：

### 1. 基础认证测试 (`01-auth.http`)
- 健康检查
- 用户登录
- 令牌刷新
- 用户登出

### 2. 用户管理测试 (`02-user.http`)
- 创建用户
- 查询用户
- 更新用户
- 删除用户

### 3. 角色权限测试 (`03-role.http`, `04-permission.http`)
- 角色CRUD操作
- 权限分配
- 权限检查

### 4. 租户管理测试 (`05-tenant.http`)
- 租户列表
- 租户切换
- 多租户隔离验证

### 5. 菜单管理测试 (`06-menu.http`)
- 菜单列表
- 用户菜单
- 菜单权限

### 6. 业务功能测试 (`07-post.http`)
- 博客文章CRUD
- 文章状态管理
- 批量操作

## 测试数据

### 默认测试账号
- 用户名: `admin`
- 密码: `admin123`

### 测试数据清理
大部分测试文件都包含数据清理步骤，在测试结束时会删除创建的测试数据。

## 接口分类说明

### 认证类接口
- **无需认证**: 健康检查、用户注册、登录、发送验证码
- **需要认证**: 刷新令牌、登出
- **需要认证+授权**: 所有业务接口

### 权限级别
- **公开接口**: 任何人都可以访问
- **认证接口**: 需要有效的访问令牌
- **授权接口**: 需要特定的权限
- **管理员接口**: 只有管理员可以访问

## 错误处理测试

每个测试文件都包含错误情况的测试用例：
- 参数验证错误 (400)
- 认证失败 (401)
- 权限不足 (403)
- 资源不存在 (404)
- 服务器内部错误 (500)

## 性能测试建议

对于性能测试，建议：
1. 使用专门的压力测试工具 (如 JMeter, AB, wrk)
2. 模拟真实的用户行为模式
3. 测试并发场景
4. 监控资源使用情况

## 注意事项

### 1. 环境依赖
- 确保 One-Auth 服务正在运行 (`localhost:5555`)
- 确保 MySQL 数据库可用
- 确保 Redis 缓存可用

### 2. 数据一致性
- 某些测试会修改数据库状态
- 建议在测试环境中运行
- 注意测试数据的清理

### 3. 并发测试
- 避免同时运行可能冲突的测试
- 注意资源竞争问题
- 使用不同的测试数据

### 4. 安全考虑
- 不要在生产环境运行测试
- 保护测试账号的安全
- 及时清理敏感测试数据

## 扩展测试

可以基于现有测试文件扩展更多测试场景：
- 边界值测试
- 异常输入测试
- 长时间运行测试
- 内存泄露测试
- 并发安全测试

## 贡献指南

添加新的测试用例时，请遵循：
1. 保持一致的命名规范
2. 添加清晰的注释说明
3. 包含错误情况测试
4. 确保测试数据的清理
5. 更新相关文档

## 故障排除

### 常见问题

1. **连接拒绝错误**
   - 检查服务是否启动
   - 验证端口配置

2. **认证失败**
   - 检查用户名密码
   - 验证Token是否过期

3. **权限不足**
   - 检查用户角色权限
   - 验证接口访问策略

4. **数据库错误**
   - 检查数据库连接
   - 验证数据完整性

### 调试建议
- 查看应用程序日志
- 使用网络抓包工具
- 检查数据库状态
- 验证配置文件

## 版本兼容性

这些测试文件适用于：
- One-Auth v1.x
- Go 1.19+
- MySQL 8.0+
- Redis 6.0+

## 联系信息

如有问题或建议，请：
- 提交 Issue
- 发起 Pull Request
- 联系项目维护者 